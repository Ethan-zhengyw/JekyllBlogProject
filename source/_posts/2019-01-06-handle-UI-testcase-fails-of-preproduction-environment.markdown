---
layout: post
title:  "类生产环境UI自动化测试失败用例处理"
date:   2019-01-06 02:00:07 +0000
tags: [SRE, 自动化测试, API设计, on-call]
categories: SRE
---
这周六服务有许多UI自动化测试用例跑失败了，直接原因是后台依赖的一个外部服务概率性需要一两分钟才返回，响应非常慢，导致后台响应前台慢，前台等待后台响应超时，于是测试用例就执行失败了。

发现外部依赖服务响应慢时，一方面需要联系相应的on-call来处理，另外一方面，还需要意识到自己的服务本身也存在可靠性问题——外部服务不总是可靠的，我们的服务需要有一定的容错机制。在响应很慢的情况下，不能一直等待对方响应，应该配置合理的超时时间，而且一次调用超时，可能只要重试一两次对方就能成功快速响应请求了。

最终的解决方案

后端访问外部服务时考虑业务健壮性，启动一个协程去调用外部服务，同时增加调用外部服务时的超时时间和重试次数配置，从而提高服务本身的可靠性。
完善监控指标和告警配置，添加从该后端组件到外部依赖服务之间的连通性指标。如果在一定长度的时间窗内，采集的连通性指标连续几次值为异常，就触发相应的告警
